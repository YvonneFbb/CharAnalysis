# å¤ç±å­—å½¢åˆ†æç³»ç»Ÿ

åŸºäºã€Šå¤§å­—ç»“æ„å…«åå››æ³•ã€‹çš„å¤ç±å­—å½¢è¯†åˆ«ä¸åˆ†æå·¥å…·

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ—¨åœ¨å¯¹å†ä»£å¤ç±åˆ»æœ¬å›¾ç‰‡è¿›è¡Œæ–‡å­—è¯†åˆ«ä¸å­—å½¢åˆ†æï¼Œé€šè¿‡æ ‡å‡†å­—é›†é©±åŠ¨çš„æ–¹å¼ï¼Œå®ç°ä¸åŒä¹¦ç±ä¹‹é—´çš„å­—å½¢å¯¹æ¯”åˆ†æã€‚

### æ ¸å¿ƒç‰¹æ€§

- **ğŸ” æ•´ä½“ OCR**ï¼šåŸºäº macOS LiveText çš„é«˜ç²¾åº¦æ–‡å­—è¯†åˆ«
- **ğŸ“š æ ‡å‡†å­—é©±åŠ¨**ï¼š333 ä¸ªæ ‡å‡†æ±‰å­—ï¼ˆæ¥è‡ªã€Šå¤§å­—ç»“æ„å…«åå››æ³•ã€‹ï¼‰
- **âš¡ å¤šçº¿ç¨‹å¤„ç†**ï¼šæ”¯æŒå¹¶å‘å¤„ç†ï¼Œå¤§å¹…æå‡å¤„ç†é€Ÿåº¦ï¼ˆ2-4å€ï¼‰
- **ğŸ¯ æ™ºèƒ½ç­›é€‰**ï¼šä» OCR ç»“æœä¸­æå–æ ‡å‡†å­—ï¼ŒæŒ‰ä¹¦ç±ç»„ç»‡
- **ğŸŒ Web å®¡æŸ¥ç•Œé¢**ï¼šFlask + æŒ‰éœ€è£åˆ‡ï¼Œæ— éœ€é¢„ç”Ÿæˆå›¾ç‰‡
- **ğŸ’¾ è¿›åº¦è¿½è¸ª**ï¼šè‡ªåŠ¨ä¿å­˜è¿›åº¦ï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ 

### å¤„ç†æµç¨‹

```
åŸå§‹ PDF å¤ç± â†’ PDFè½¬æ¢ â†’ é¢„å¤„ç† â†’ OCRè¯†åˆ« â†’ æ ‡å‡†å­—åŒ¹é… â†’ Webå®¡æŸ¥ â†’ å¯¼å‡ºç»“æœ
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**ï¼šmacOSï¼ˆOCR ä¾èµ– macOS LiveTextï¼‰
- **Python**ï¼š3.10+
- **ä¾èµ–**ï¼šOpenCV, PyMuPDF, Flask, ocrmac, etc.

### å®‰è£…

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <repository-url>
cd CharAnalysis

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv .venv
source .venv/bin/activate

# 3. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 4. éªŒè¯å®‰è£…
./pipeline config
```

### å®Œæ•´å·¥ä½œæµç¨‹

```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source .venv/bin/activate

# æ­¥éª¤ 1: PDF è½¬å›¾ç‰‡ï¼ˆå¤šçº¿ç¨‹ï¼‰
./pipeline convert data/raw/ --max-volumes 5 --workers 4

# æ­¥éª¤ 2: å›¾åƒé¢„å¤„ç†ï¼ˆå¤šçº¿ç¨‹ï¼‰
./pipeline preprocess data/raw/ --max-volumes 5 --workers 6

# æ­¥éª¤ 3: OCR è¯†åˆ«ï¼ˆå¤šçº¿ç¨‹ï¼‰
./pipeline ocr data/results/preprocessed/ --max-volumes 5 --workers 8

# æˆ–è€…ä½¿ç”¨ all å‘½ä»¤ä¸€æ¬¡å®Œæˆé¢„å¤„ç†+OCR
./pipeline all data/raw/ --max-volumes 5 --workers 6

# æ­¥éª¤ 4: åŒ¹é…æ ‡å‡†å­—
./pipeline match data/results/ocr/

# æ­¥éª¤ 5: å¯åŠ¨å®¡æŸ¥ç•Œé¢
cd src/review
python3 app.py
# è®¿é—® http://localhost:5001/review

# æ­¥éª¤ 6: åœ¨ Web ç•Œé¢ä¸­å®¡æŸ¥å¹¶å¯¼å‡ºç»“æœ
```

## ğŸ“– è¯¦ç»†æ–‡æ¡£

### å‘½ä»¤è¡Œå·¥å…·

æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å‘½ä»¤ï¼š

```bash
./pipeline --help
```

ä¸»è¦å‘½ä»¤ï¼š

| å‘½ä»¤ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `convert` | PDF è½¬å›¾ç‰‡ | `./pipeline convert data/raw/ --workers 4` |
| `preprocess` | å›¾åƒé¢„å¤„ç† | `./pipeline preprocess data/raw/ --workers 6` |
| `ocr` | OCR è¯†åˆ« | `./pipeline ocr data/results/preprocessed/ --workers 8` |
| `all` | é¢„å¤„ç†+OCR | `./pipeline all data/raw/ --workers 6` |
| `match` | åŒ¹é…æ ‡å‡†å­— | `./pipeline match data/results/ocr/` |
| `crop` | è£åˆ‡å­—ç¬¦ | `./pipeline crop data/results/matched_by_book.json --book "ä¹¦å"` |
| `config` | æ˜¾ç¤ºé…ç½® | `./pipeline config` |

### å¤šçº¿ç¨‹é…ç½®

æ‰€æœ‰æ‰¹å¤„ç†å‘½ä»¤éƒ½æ”¯æŒ `--workers` å‚æ•°ï¼š

```bash
# PDF è½¬æ¢ï¼š4-6 çº¿ç¨‹ï¼ˆI/O å¯†é›†ï¼‰
./pipeline convert data/raw/ --workers 4

# é¢„å¤„ç†ï¼š6-7 çº¿ç¨‹ï¼ˆCPU å¯†é›†ï¼Œæ ¸å¿ƒæ•° - 1ï¼‰
./pipeline preprocess data/raw/ --workers 6

# OCRï¼š8-12 çº¿ç¨‹ï¼ˆI/O+CPU æ··åˆï¼Œæ ¸å¿ƒæ•° Ã— 1.5ï¼‰
./pipeline ocr data/results/preprocessed/ --workers 10
```

**æ¨èé…ç½®**ï¼ˆ8æ ¸ CPUï¼‰ï¼š
- PDF è½¬æ¢ï¼š4çº¿ç¨‹
- é¢„å¤„ç†ï¼š6-7çº¿ç¨‹
- OCRï¼š8-10çº¿ç¨‹

### è¿›åº¦è·Ÿè¸ª

æ‰€æœ‰æ‰¹å¤„ç†å‘½ä»¤éƒ½æ”¯æŒè¿›åº¦è·Ÿè¸ªå’Œæ–­ç‚¹ç»­ä¼ ï¼š

```bash
# æ­£å¸¸å¤„ç†ï¼ˆè‡ªåŠ¨ä¿å­˜è¿›åº¦ï¼‰
./pipeline preprocess data/raw/ --workers 6

# ä¸­æ–­åé‡æ–°è¿è¡Œï¼Œä¼šä»ä¸Šæ¬¡åœæ­¢çš„åœ°æ–¹ç»§ç»­
./pipeline preprocess data/raw/ --workers 6

# å¼ºåˆ¶é‡æ–°å¤„ç†æ‰€æœ‰æ–‡ä»¶ï¼ˆå¿½ç•¥è¿›åº¦ï¼‰
./pipeline preprocess data/raw/ --workers 6 --force
```

### Web å®¡æŸ¥ç•Œé¢

å¯åŠ¨å®¡æŸ¥æœåŠ¡å™¨ï¼š

```bash
cd src/review
python3 app.py
```

è®¿é—®ï¼šhttp://localhost:5001/review

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- é€‰æ‹©ä¹¦ç±ï¼ˆ38æœ¬å¤ç±ï¼‰
- æŒ‰ 84 æ³•åˆ†ç±»æµè§ˆå­—ç¬¦
- å•å‡»é€‰æ‹©/å–æ¶ˆé€‰æ‹©å®ä¾‹
- åˆ†é¡µæµè§ˆï¼ˆæ¯é¡µ 20 ä¸ªå®ä¾‹ï¼‰
- å®æ—¶è¿›åº¦æ˜¾ç¤º
- å¯¼å‡º/å¯¼å…¥å®¡æŸ¥ç»“æœ

è¯¦ç»†ä½¿ç”¨è¯´æ˜ï¼š[å®¡æŸ¥ç•Œé¢ä½¿ç”¨è¯´æ˜.md](å®¡æŸ¥ç•Œé¢ä½¿ç”¨è¯´æ˜.md)

## ğŸ“ é¡¹ç›®ç»“æ„

```
CharAnalysis/
â”œâ”€â”€ src/                        # æºä»£ç 
â”‚   â”œâ”€â”€ pipeline.py             # ä¸»ç¨‹åºï¼ˆCLI æ¥å£ï¼‰
â”‚   â”œâ”€â”€ config.py               # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ preprocess/             # å›¾åƒé¢„å¤„ç†
â”‚   â”œâ”€â”€ ocr/                    # OCR è¯†åˆ«
â”‚   â”œâ”€â”€ filter/                 # æ ‡å‡†å­—åŒ¹é…
â”‚   â”œâ”€â”€ crop/                   # å­—ç¬¦è£åˆ‡
â”‚   â”œâ”€â”€ review/                 # Web å®¡æŸ¥ç•Œé¢
â”‚   â””â”€â”€ utils/                  # å·¥å…·æ¨¡å—
â”œâ”€â”€ data/                       # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ standard_chars.json     # æ ‡å‡†å­—é›†ï¼ˆ84æ³•åˆ†ç±»ï¼‰
â”‚   â”œâ”€â”€ raw/                    # åŸå§‹ PDF/å›¾ç‰‡
â”‚   â””â”€â”€ results/                # å¤„ç†ç»“æœ
â”‚       â”œâ”€â”€ preprocessed/       # é¢„å¤„ç†å›¾ç‰‡
â”‚       â”œâ”€â”€ ocr/                # OCR ç»“æœ JSON
â”‚       â”œâ”€â”€ matched_by_book.json # åŒ¹é…ç»“æœ
â”‚       â””â”€â”€ review_app.html     # å®¡æŸ¥ç•Œé¢
â”œâ”€â”€ pipeline                    # å‘½ä»¤è¡Œå·¥å…·
â”œâ”€â”€ requirements.txt            # Python ä¾èµ–
â”œâ”€â”€ README.md                   # æœ¬æ–‡ä»¶
â”œâ”€â”€ CLAUDE.md                   # å¼€å‘å¤‡å¿˜
â””â”€â”€ CHANGELOG_20251025.md       # æ›´æ–°æ—¥å¿—
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **Python 3.10+**ï¼šä¸»è¦å¼€å‘è¯­è¨€
- **OpenCV**ï¼šå›¾åƒå¤„ç†ï¼ˆCLAHEã€å½¢æ€å­¦ã€æ»¤æ³¢ï¼‰
- **PyMuPDF (fitz)**ï¼šPDF è½¬å›¾ç‰‡
- **ocrmac**ï¼šmacOS LiveText OCR å°è£…
- **Flask**ï¼šWeb å®¡æŸ¥ç•Œé¢åç«¯
- **NumPy**ï¼šæ•°å€¼è®¡ç®—
- **tqdm**ï¼šè¿›åº¦æ¡æ˜¾ç¤º
- **concurrent.futures**ï¼šå¤šçº¿ç¨‹å¤„ç†

## ğŸ“Š æ•°æ®ç»Ÿè®¡

åŸºäºå½“å‰å¤„ç†çš„æ•°æ®ï¼š

- **ä¹¦ç±æ•°é‡**ï¼š38 æœ¬å¤ç±
- **æ ‡å‡†å­—é›†**ï¼š333 ä¸ªå­—ç¬¦ï¼ˆ84 ä¸ªåˆ†ç±»æ³•ï¼‰
- **å­—ç¬¦è¦†ç›–ç‡**ï¼š324/333ï¼ˆ97.3%ï¼‰
- **æ€»å®ä¾‹æ•°**ï¼šçº¦ 1,000,000+ ä¸ªå­—ç¬¦å®ä¾‹

## ğŸ¯ æ ¸å¿ƒè®¾è®¡

### 1. æ ‡å‡†å­—é©±åŠ¨

- ä»ã€Šå¤§å­—ç»“æ„å…«åå››æ³•ã€‹æå– 333 ä¸ªæ ‡å‡†å­—
- 84 ä¸ªä¹¦æ³•ç»“æ„åˆ†ç±»
- æ•°æ®é‡å¯æ§ï¼Œæ”¯æŒäººå·¥å®¡æŸ¥

### 2. æŒ‰ä¹¦ç±ç»„ç»‡

- æ¯æœ¬ä¹¦ç‹¬ç«‹å¤„ç†å’Œç»Ÿè®¡
- ä¾¿äºå¢é‡å¤„ç†
- ä¾¿äºå­—å½¢å¯¹æ¯”åˆ†æ

### 3. æŒ‰éœ€è£åˆ‡

- æ— éœ€é¢„ç”Ÿæˆ 100ä¸‡+ å¼ å›¾ç‰‡
- å®æ—¶è£åˆ‡ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´
- åŠ è½½é€Ÿåº¦å¿«ï¼ˆæ¯é¡µä»… 20 ä¸ªå®ä¾‹ï¼‰

### 4. å¤šçº¿ç¨‹å¤„ç†

- 2-4å€é€Ÿåº¦æå‡
- çº¿ç¨‹å®‰å…¨çš„è¿›åº¦è·Ÿè¸ª
- å®Œå…¨å‘åå…¼å®¹

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **macOS ä¾èµ–**ï¼šocrmac åªèƒ½åœ¨ macOS ä¸Šè¿è¡Œ
2. **çº¿ç¨‹æ•°é…ç½®**ï¼šä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œå»ºè®®ä¸è¶…è¿‡ CPU æ ¸å¿ƒæ•° Ã— 1.5
3. **å†…å­˜å ç”¨**ï¼šå¤§é‡å¹¶å‘å¤„ç†æ—¶æ³¨æ„å†…å­˜å ç”¨
4. **è¿›åº¦æ–‡ä»¶**ï¼š`.progress` æ–‡ä»¶è®°å½•å¤„ç†è¿›åº¦ï¼Œå¯æ‰‹åŠ¨åˆ é™¤ä»¥é‡æ–°å¼€å§‹

## ğŸ“ ç¤ºä¾‹

### å¤„ç†å•æœ¬ä¹¦

```bash
# 1. PDF è½¬å›¾ç‰‡
./pipeline convert data/raw/01_1127_å°šä¹¦æ­£ä¹‰/ --workers 2

# 2. é¢„å¤„ç†
./pipeline preprocess data/raw/01_1127_å°šä¹¦æ­£ä¹‰/ --workers 4

# 3. OCR
./pipeline ocr data/results/preprocessed/01_1127_å°šä¹¦æ­£ä¹‰/ --workers 6

# 4. åŒ¹é…ï¼ˆä¼šåŒ¹é…æ‰€æœ‰ä¹¦ç±ï¼‰
./pipeline match data/results/ocr/

# 5. è£åˆ‡ï¼ˆåªè£åˆ‡è¿™æœ¬ä¹¦ï¼‰
./pipeline crop data/results/matched_by_book.json --book "01_1127_å°šä¹¦æ­£ä¹‰"
```

### æ‰¹é‡å¤„ç†å¤šæœ¬ä¹¦

```bash
# é™åˆ¶æ¯æœ¬ä¹¦åªå¤„ç†å‰ 5 å†Œï¼Œä½¿ç”¨ 4 çº¿ç¨‹
./pipeline convert data/raw/ --max-volumes 5 --workers 4
./pipeline all data/raw/ --max-volumes 5 --workers 6
./pipeline match data/results/ocr/
```

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [CLAUDE.md](CLAUDE.md) - é¡¹ç›®å¼€å‘å¤‡å¿˜
- [å®¡æŸ¥ç•Œé¢ä½¿ç”¨è¯´æ˜.md](å®¡æŸ¥ç•Œé¢ä½¿ç”¨è¯´æ˜.md) - Web å®¡æŸ¥ç•Œé¢ä½¿ç”¨æŒ‡å—
- [CHANGELOG_20251025.md](CHANGELOG_20251025.md) - æœ€æ–°æ›´æ–°æ—¥å¿—

## ğŸ“„ è®¸å¯è¯

[è®¸å¯è¯ä¿¡æ¯å¾…è¡¥å……]

## ğŸ‘¥ è´¡çŒ®

æ¬¢è¿æäº¤ Issues å’Œ Pull Requestsï¼

---

**æœ€åæ›´æ–°**ï¼š2025-10-25
**ç‰ˆæœ¬**ï¼š2.0.0ï¼ˆæ”¯æŒå¤šçº¿ç¨‹å¤„ç†ï¼‰
